<!doctype html>
<html lang="en">
<head>
    <title>Custom VPN using PiVPN and public cloud</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Adam Novotny's website. LinkedIn, Medium, Twiter.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <base href="/">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_purple-light_blue.min.css" /> 
    <link rel="stylesheet" type="text/css" href="/theme/css/style.css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="demo-blog demo-blog--blogpost mdl-layout mdl-js-layout has-drawer is-upgraded">
        <main class="mdl-layout__content">

<div class="demo-blog__posts mdl-grid">
    <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">
        <div class="mdl-card__media mdl-color-text--grey-50" style="background-image: url(/theme/images/1*hI_JbE-q2OQpXW1tEB46Cg.png.png); background-repeat: no-repeat; background-size: cover;">
        <h3>Custom VPN using PiVPN and public cloud</h3>
        </div>
        <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">
        <div>
            <strong>Adam Novotny</strong>
            <span>2018-12-30</span>
        </div>
        <div class="section-spacer"></div>
        <div>
            <a href="https://twitter.com/excitedAtom">
                <i class="material-icons" role="presentation">share</i>
                <span class="visuallyhidden">share</span>
            </a>
        </div>
        </div>
        <div class="mdl-color-text--grey-700 mdl-card__supporting-text">
            <p>Motivation: Many public Wi-Fi networks block certain internet ports and protocols. For example, a public library might only allow ports 80 and 443 and the TCP protocol. Leaving aside the logic of such decisions by network owners, they prevent users from taking advantage of many commercial VPN products that rely on other ports. The goal of this article is to create a custom VPN solution to improve privacy even on such restricted public networks.</p>

<p><img src="/theme/images/1*hI_JbE-q2OQpXW1tEB46Cg.png.png" alt="AWS, Google Cloud, Microsoft Azure" style="width: 100%">
<img src="/theme/images/1*7C1odbX4Kk_yxToAaKnlwA.png.png" alt="PiVPN" style="width: 100%">
<p>All step are outlined in more detail in <a href="https://github.com/adam5ny/vpn-gcp-pivpn" target="_blank">this Github repo</a>. The tutorial is written for Python 3 and <a href="https://cloud.google.com/compute/" target="_blank">Google Cloud Compute</a>. However, all public clouds can be used including AWS or Azure.</p>
<p>Create public cloud compute instance</p>
<p>Login to <a href="https://console.cloud.google.com/" target="_blank">GCP console</a>. Create an Ubuntu machine and make sure to allow https traffic. Then locate your public IP which is where your traffic will be routed. In GCP, you can find it using the following steps (as of Dec 2018): VPC network &gt; External IP addresses &gt; switch the type of your instance IP from “Ephemeral” to “Static”. This will be your public IP.</p>
<p>Create PiVPN instance</p>
<p>Login to your compute instance and download PiVPN using the following command:</p>
<pre>curl -L <a href="https://install.pivpn.io" target="_blank">https://install.pivpn.io</a> | bash</pre>
<p>Follow all setup steps using default values except for port and protocol. Select port 443 and protocol TCP. Select reboot at the end of the installation.</p>
<p>Create VPN credentials</p>
<pre>pivpn add</pre>
<p>Enter your custom username and password. Download credentials to your computer from your newly create cloud computer instance. Credentials are typically located at ~/ovpns on your Ubuntu instance.</p>
<p>Download a VPN client for your platform</p>
<p>For MacOS you may use <a href="https://tunnelblick.net/" target="_blank">Tunnelblick</a>. Then drag credentials (.ovpn) from the previous step to the Tunneblick app icon. Click on Tunneblick icon to connect to your VPN with your custom username and password.</p>
<p>Final notes:</p>
<ul><li>use port 80 instead of 443 above if necessary.</li></ul>
<ul><li>to minimize cost, remember to shut down your compute instance when you are not using the VPN. The typical cost is &lt; $20 for 100GB of traffic and 24/7 usage which is in line with respectable third-party VPN providers. However, your cost may be significantly lower if you shut down unused instances and use pre-emptible instances (GCP-specific).</li></ul>
<p>Author website: <a href="https://www.adamnovotny.com/" target="_blank">adamnovotny.com</a></p></p>
            <a href="https://medium.com/@excitedAtom/custom-vpn-using-pivpn-and-public-cloud-d3b3b71b6698/"><i class="fab fa-medium fa-lg"></i></a>
        </div>
    </div>
</div>


            <footer class="mdl-mini-footer">
                <div class="mdl-mini-footer--left-section">
                    <a href="https://keybase.io/adam5ny">Keybase <i class="fab fa-keybase fa-lg"></i></a>
                    <a href="https://github.com/excitedAtom">Github <i class="fab fa-github fa-lg"></i></a>
                    <a href="https://www.linkedin.com/in/excitedAtom">LinkedIn <i class="fab fa-linkedin fa-lg"></i></a>
                    <a href="https://medium.com/@excitedAtom">Medium <i class="fab fa-medium fa-lg"></i></a>
                    <a href="/quotes/q-list.html">Quotes</a>
                    
                </div>
                <div class="mdl-mini-footer--right-section">
                    <a href="https://twitter.com/excitedAtom">Twitter <i class="fab fa-twitter fa-lg"></i></a>
                </div>
            </footer>
        </main>
        <div class="mdl-layout__obfuscator"></div>
    </div>
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script src="/theme/js/main.js" defer></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-71868344-1', 'auto');
        ga('send', 'pageview');
    </script>
</body>
<script>
    Array.prototype.forEach.call(document.querySelectorAll('.mdl-card__media'), function(el) {
        var link = el.querySelector('a');
        if(!link) {
        return;
        }
        var target = link.getAttribute('href');
        if(!target) {
        return;
        }
        el.addEventListener('click', function() {
        location.href = target;
        });
    });
</script>
</html>